<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Family Archives</title>

<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=VT323&family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
/* ⚠️ DESIGN UNCHANGED — EXACTLY AS YOU HAD IT */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:"VT323",monospace;background:linear-gradient(135deg,#8B4513 0%,#D2691E 50%,#CD853F 100%);background-attachment:fixed;padding:20px;min-height:100vh;}
body::before{content:"";position:fixed;top:0;left:0;width:100%;height:100%;background:repeating-linear-gradient(0deg,rgba(0,0,0,.05) 0,rgba(0,0,0,.05) 1px,transparent 1px,transparent 2px);pointer-events:none;z-index:1000;}
.container{max-width:900px;margin:0 auto;position:relative;z-index:1;}
.hidden{display:none;}
/* (rest of your CSS exactly the same — omitted here for brevity in explanation but NOT changed) */
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen" class="login-container">
<h2>the family archives</h2>
<p>sign in to continue...</p>
<input type="text" id="username" placeholder="username">
<input type="password" id="password" placeholder="password">
<button onclick="login()">enter</button>
<button onclick="showRegister()">create account</button>
<div id="loginError" class="error"></div>
</div>

<!-- MAIN -->
<div id="mainApp" class="hidden">
<div class="container">

<div class="header">
<div>
<h1>the family archives</h1>
<p>hey there, <span id="currentUser"></span>!</p>
</div>
<button class="logout-btn" onclick="logout()">logout</button>
</div>

<div class="create-post">
<h3>// new entry</h3>
<textarea id="newPostContent" placeholder="what's happening in the family?"></textarea>
<button onclick="createPost()">post update</button>
</div>

<div id="feed"><div class="loading">loading the archives...</div></div>

</div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getFirestore, collection, addDoc, getDoc, getDocs, updateDoc, doc, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const firebaseConfig = {
apiKey: "AIzaSyBcLB4LtI3f7Xuxa4tMCxzcSG6Bi3XSaOI",
authDomain: "snuketownusa.firebaseapp.com",
projectId: "snuketownusa",
storageBucket: "snuketownusa.firebasestorage.app",
messagingSenderId: "294126465212",
appId: "1:294126465212:web:55e21ba84523144eafa0b9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db = db;
window.collection = collection;
window.addDoc = addDoc;
window.getDoc = getDoc;
window.updateDoc = updateDoc;
window.doc = doc;
window.query = query;
window.orderBy = orderBy;
window.onSnapshot = onSnapshot;
</script>

<script>
function getCurrentUser(){return localStorage.getItem('currentUser');}

function showMainApp(){
loginScreen.classList.add('hidden');
mainApp.classList.remove('hidden');
currentUser.textContent = getCurrentUser();
listenToPosts();
}

async function createPost(){
const content = newPostContent.value.trim();
if(!content) return alert('please write something!');
await addDoc(collection(db,'posts'),{
author:getCurrentUser(),
content,
timestamp:new Date(),
reactions:{},
comments:[]
});
newPostContent.value='';
}

function listenToPosts(){
const q = query(collection(db,'posts'), orderBy('timestamp','desc'));
onSnapshot(q,snap=>{
const posts=[];
snap.forEach(d=>posts.push({id:d.id,...d.data()}));
displayPosts(posts);
});
}

function displayPosts(posts){
feed.innerHTML='';
posts.forEach(post=>{
feed.innerHTML+=`
<div class="post">
<strong>${post.author}</strong>
<div>${post.content}</div>

<div class="comments">
${(post.comments||[]).map(c=>`
<div class="comment">
<div class="comment-header">${c.author}</div>
<div>${c.text}</div>
</div>`).join('')}

<div class="comment-form">
<input id="comment-${post.id}" placeholder="write a comment...">
<button onclick="addComment('${post.id}')">comment</button>
</div>
</div>
</div>`;
});
}

async function addComment(postId){
const input = document.getElementById(`comment-${postId}`);
const text = input.value.trim();
if(!text) return;

const ref = doc(db,'posts',postId);
const snap = await getDoc(ref);
const comments = snap.data().comments || [];

comments.push({author:getCurrentUser(),text,timestamp:new Date()});
await updateDoc(ref,{comments});
input.value='';
}

function logout(){
localStorage.removeItem('currentUser');
location.reload();
}
</script>

</body>
</html>
